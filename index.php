<?php
include'db.php';if($_SERVER['REQUEST_METHOD']==='POST'&&isset($_POST['feed_url'])){$a=$_POST['feed_url'];if(!empty($a)){$b=$conn->prepare("INSERT IGNORE INTO feeds(url)VALUES(:a)");$b->bindParam(':a',$a);if($b->execute()){$c="Feed agregado correctamente.";}else{$c="Error al agregar el feed.";}}else{$c="La URL no puede estar vacía.";}}$d=isset($_GET['order'])?$_GET['order']:'pub_date DESC';$e=isset($_GET['search'])?$_GET['search']:'';$f="SELECT news.*,feeds.url AS feed_url FROM news JOIN feeds ON news.feed_id=feeds.id";if($e){$f.=" WHERE title LIKE :e OR description LIKE :e";}$f.=" ORDER BY $d";$g=$conn->prepare($f);if($e){$g->bindValue(':e',"%$e%");}$g->execute();$h=$g->fetchAll(PDO::FETCH_ASSOC);?><!DOCTYPE html><html lang=es><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>El mejor Lector RSS de la vida</title><link rel=stylesheet href=styles.css></head><body><div class=main-container><div class=image-gallery><img src=images/SoraAlejandro.jpg alt="Su main en Smash"><img src=images/WargreymonGildardo.jpg alt="su Digimon favorito"><img src=images/RoaringMuñoz.jpg alt="Su deck"></div><header class=page-header><h1>El mejor lector RSS de la vida, para videojuegos y tecnología</h1></header><div class=content-wrapper><div class=form-section><form action=index.php method=post><input type=text name=feed_url placeholder="Ingresa la URL del feed" required><button type=submit>Agregar Feed</button></form><?php if(isset($c)):?><div class="alert-message <?php echo strpos($c,'Error')!==false?'error':'success';?>"><?php echo htmlspecialchars($c);?></div><?php endif;?><form action=index.php method=get class=search-form><input type=text name=search placeholder="Buscar noticias..." value="<?php echo htmlspecialchars($e);?>"><button type=submit>Buscar</button></form></div><div class=action-buttons><button onclick="window.location.href='update_feeds.php'">Actualizar Feeds</button></div><div class=table-container><table class=news-table><thead><tr><th><a href="index.php?order=title">Título</a></th><th><a href="index.php?order=description">Descripción</a></th><th><a href="index.php?order=categories">Categorías</a></th><th><a href="index.php?order=pub_date">Fecha</a></th></tr></thead><tbody><?php foreach($h as$i):?><tr><td><a href="<?php echo htmlspecialchars($i['url']);?>"><?php echo htmlspecialchars($i['title']);?></a></td><td><?php echo htmlspecialchars($i['description']);?></td><td><?php echo htmlspecialchars($i['categories']);?></td><td><?php echo htmlspecialchars($i['pub_date']);?></td></tr><?php endforeach;?></tbody></table></div></div></div></body></html>